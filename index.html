<script>
const form = document.getElementById('declarationForm');
const messageElement = document.getElementById('message');

// URL de tu Cloudflare Worker
const WORKER_URL = "https://appexternaarchivos.manzjulio064.workers.dev/";

form.addEventListener('submit', function(e) {
  e.preventDefault();

  const formData = new FormData(form);
  const archivo = formData.get('archivo');

  if (!archivo) {
    messageElement.textContent = "❌ Debes adjuntar un archivo.";
    return;
  }

  const reader = new FileReader();
  reader.onload = function() {
    const payload = {
      nombre: formData.get('nombre'),
      apellido: formData.get('apellido'),
      archivoNombre: archivo.name,
      archivoTipo: archivo.type,
      archivoBase64: reader.result.split(',')[1]
    };

    messageElement.textContent = "⏳ Enviando...";

    fetch(WORKER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(response => {
      messageElement.textContent = response.success ? response.message : `❌ ${response.message}`;
      if (response.success) form.reset();
    })
    .catch(error => {
      messageElement.textContent = `❌ Error: ${error.message}`;
    });
  };
  reader.readAsDataURL(archivo);
});
</script>

